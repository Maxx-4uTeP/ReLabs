# CPH 08: Лучшие практики Ceph
##### [Оглавление](../README.md)


### Задание:
Теоретическое задание. Для выполнения добавьте команды в файл /home/user/answer на выданной машине.

##### Текст задания:

Вам дан кластер с 120 OSD. В кластере создается один пул для RDB с названием rbd и один пул для CEPHFS с названием cephfs. Надо посчитать, сколько PG нужно этим пулам при равноправном распределении, если фактор репликации каждого пула равен 3. PG расчитываются только для пулов с данными. Пулы с метасодержимым, технические пулы, в виду их незначительного размера используют минимальное число PG. В ответ в файл /home/user/answer добавьте команды создания данных пулов (создание пула с полученным значением pg, установление для пула фактора репликации, равного 3). Подсказка: искомое значение pg, общее для двух пулов, будет равно ближайшей степени 2ки от полученного в расчетах значения.


## Практика:
Напомним про расчет PG вручную. Для расчета общего количества PG используется следующая формула:

> Total PGs = (Total_number_of_OSD * 100) / max_replication_count

Мы берем количество дисков, умножаем на 100 (100%-е заполнение) и делим на максимальный фактор репликации. Получаем общее число placement групп. Дальше его делим на количество пулов и находим степень двойки, превосходящую полученное число. То есть, не может получиться 3001 плейсмент группа, мы приводим это число к ближайшей наибольшей степени двойки — в нашем случае 4096.

## Ответ:
Калькулятор: https://docs.ceph.com/en/latest/rados/operations/pgcalc/#
```bash
ceph osd pool create rbd 2048
ceph osd pool set rbd size 3
while [ $(ceph -s | grep creating -c) -gt 0 ]; do echo -n .;sleep 1; done

ceph osd pool create cephfs 2048
ceph osd pool set cephfs size 3
while [ $(ceph -s | grep creating -c) -gt 0 ]; do echo -n .;sleep 1; done
```

